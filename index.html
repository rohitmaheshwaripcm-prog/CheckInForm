<!DOCTYPE html>
<html>
<head>
  <title>Hotel Check-In System</title>
  <style>
    /* Basic styling omitted for brevity, use styles from previous examples */
  </style>
</head>
<body>

<h2>Hotel Check-In System</h2>

<nav>
  <button id="tabForm" class="active">Check In</button>
  <button id="tabInHouse">In House Guests</button>
  <button id="tabRecords">All Records</button>
</nav>

<section id="formSection" class="active">
  <form id="checkinForm">
    <label>Name *</label><input type="text" name="Name" required />
    <label>Phone *</label><input type="text" name="Phone" required />
    <label>Street *</label><input type="text" name="Street" required />
    <label>City *</label><input type="text" name="City" required />
    <label>Pincode *</label><input type="text" name="Pincode" required />
    <label>Check-In Number *</label><input type="text" name="CheckInNumber" required />
    <label>Check In Date (DD-MM-YYYY) *</label><input type="text" name="CheckInDate" placeholder="DD-MM-YYYY" required />
    <label>Check Out Date (DD-MM-YYYY) *</label><input type="text" name="CheckOutDate" placeholder="DD-MM-YYYY" required />
    <label>Adults *</label><input type="number" name="Adults" min="0" required />
    <label>Children *</label><input type="number" name="Children" min="0" required />
    <label>Plan *</label>
    <select name="Plan" required>
      <option value="">Select</option>
      <option>Room Only</option>
      <option>Breakfast Included</option>
      <option>Half Board</option>
      <option>Full Board</option>
    </select>
    <label>Number of Rooms *</label><input type="number" name="NumRooms" min="1" required />
    <label>Room Numbers *</label><input type="text" name="RoomNumbers" required />
    <label>Coming From *</label><input type="text" name="ComingFrom" required />
    <label>Going To *</label><input type="text" name="GoingTo" required />
    <label>Vehicle Number</label><input type="text" name="VehicleNumber" />
    <button type="submit">Check In</button>
  </form>
</section>

<section id="inHouseSection">
  <h3>In House Guests</h3>
  <table id="inHouseTable" aria-label="Guests currently checked in">
    <thead>
      <tr>
        <th>Check-In Number</th><th>Name</th><th>Room Number</th><th>Check In Date</th><th>Check Out Date</th><th>Plan</th><th>Adults</th><th>Children</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="recordsSection">
  <input type="text" id="searchInput" placeholder="Search by Name, Room Number, Check-in Number or Date" />
  <button id="exportBtn">Export CSV</button>
  <table id="recordsTable" aria-label="All Check-in Records">
    <thead>
      <tr>
        <th>Check-In Number</th><th>Name</th><th>Street</th><th>City</th><th>Pincode</th><th>Check In Date</th><th>Check Out Date</th><th>Adults</th><th>Children</th><th>Plan</th><th>#Rooms</th><th>Room Numbers</th><th>Coming From</th><th>Going To</th><th>Vehicle Number</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
  const googleScriptUrl = 'YOUR_DEPLOYED_SCRIPT_URL'; // Update this

  // Tabs controls
  const tabForm = document.getElementById('tabForm');
  const tabInHouse = document.getElementById('tabInHouse');
  const tabRecords = document.getElementById('tabRecords');
  const formSection = document.getElementById('formSection');
  const inHouseSection = document.getElementById('inHouseSection');
  const recordsSection = document.getElementById('recordsSection');

  function setActiveTab(t) {
    tabForm.classList.remove('active');
    tabInHouse.classList.remove('active');
    tabRecords.classList.remove('active');
    formSection.style.display = 'none';
    inHouseSection.style.display = 'none';
    recordsSection.style.display = 'none';

    if(t === 'form') {
      tabForm.classList.add('active');
      formSection.style.display = 'block';
    } else if(t === 'inHouse') {
      tabInHouse.classList.add('active');
      inHouseSection.style.display = 'block';
      loadInHouseGuests();
    } else if(t === 'records') {
      tabRecords.classList.add('active');
      recordsSection.style.display = 'block';
      loadAllRecords();
    }
  }

  tabForm.onclick = () => setActiveTab('form');
  tabInHouse.onclick = () => setActiveTab('inHouse');
  tabRecords.onclick = () => setActiveTab('records');

  // Submit form to add record
  document.getElementById('checkinForm').addEventListener('submit', async e => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const record = {};
    formData.forEach((v,k) => record[k] = v.trim());
    const resp = await fetch(googleScriptUrl, {
      method: 'POST',
      body: JSON.stringify({action:"add", record}),
      headers: {"Content-Type":"application/json"}
    });
    const json = await resp.json();
    if(json.result === 'success') {
      alert("Check-in record added.");
      e.target.reset();
      setActiveTab('inHouse');
    } else {
      alert("Failed to add record.");
    }
  });

  // Load all records (All Records Tab)
  async function loadAllRecords() {
    const tbody = document.querySelector('#recordsTable tbody');
    tbody.innerHTML = '<tr><td colspan="15">Loading...</td></tr>';
    try {
      const resp = await fetch(googleScriptUrl);
      const data = await resp.json();
      tbody.innerHTML = '';
      data.forEach(r => {
        const tr = document.createElement('tr');
        ['CheckInNumber','Name','Street','City','Pincode','CheckInDate','CheckOutDate','Adults','Children','Plan','NumRooms','RoomNumbers','ComingFrom','GoingTo','VehicleNumber']
          .forEach(f => {
            const td = document.createElement('td');
            td.textContent = r[f]||'';
            tr.appendChild(td);
          });
        tbody.appendChild(tr);
      });
    } catch(e) {
      tbody.innerHTML = '<tr><td colspan="15">Error loading records</td></tr>';
    }
  }

  // Load in-house guests (check if today is between checkin- checkout dates)
  async function loadInHouseGuests() {
    const tbody = document.querySelector('#inHouseTable tbody');
    tbody.innerHTML = '<tr><td colspan="8">Loading...</td></tr>';
    try {
      const resp = await fetch(googleScriptUrl);
      const data = await resp.json();
      const today = new Date();
      tbody.innerHTML = '';
      function parseDate(str) {
        const parts = str.split('-');
        if(parts.length === 3) return new Date(parts[2], parts[1]-1, parts);
        return null;
      }
      const filtered = data.filter(r => {
        const ci = parseDate(r.CheckInDate);
        const co = parseDate(r.CheckOutDate);
        if(!ci || !co) return false;
        return today >= ci && today < co;
      });
      if(filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8">No in house guests found</td></tr>';
        return;
      }
      filtered.forEach(r => {
        const tr = document.createElement('tr');
        ['CheckInNumber','Name','RoomNumbers','CheckInDate','CheckOutDate','Plan','Adults','Children']
          .forEach(f => {
            const td = document.createElement('td');
            td.textContent = r[f]||'';
            tr.appendChild(td);
          });
        tbody.appendChild(tr);
      });
    } catch(e) {
      tbody.innerHTML = '<tr><td colspan="8">Error loading in house guests</td></tr>';
    }
  }

  setActiveTab('form'); // default on load
</script>

</body>
</html>
